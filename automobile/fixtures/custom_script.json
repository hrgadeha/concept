[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Attendance",
  "modified": "2019-06-05 17:16:37.728384",
  "name": "Attendance-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Attendance', {\n\tvalidate(frm) {\n\t\tif (!frm.doc.location && frm.doc.latitude && frm.doc.longitude) {\n\t\t\tfrm.fields_dict.location.map.setView([frm.doc.latitude, frm.doc.longitude], 13);\n\t\t}\n\t\telse {\n\t\t\tfrm.doc.latitude = frm.fields_dict.location.map.getCenter()['lat'];\n\t\t\tfrm.doc.longitude = frm.fields_dict.location.map.getCenter()['lng'];\n\t\t}\n\t},\n});\n\nfrappe.ui.form.on(\"Attendance\", \"google_map\", function(frm) {\n   window.open(\"http://www.google.com/maps/place/\" + frm.doc.latitude + \",\" + frm.doc.longitude)\n});"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Lead",
  "modified": "2019-11-21 14:34:06.834703",
  "name": "Lead-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Lead', {\n    onload(frm) {\n\t\tif(frm.doc.buyer_type_ == 'First Time'){\n\t\t    frm.set_value(\"currently_are_you_using_any_4_wheeler\",\"No\");\n\t\t    frm.set_value(\"exchange_require\",\"No\");\n\t\t    frm.set_df_property('currently_are_you_using_any_4_wheeler',  'read_only',1);\n\t\t    frm.set_df_property('exchange_require',  'read_only',1);\n\t\t}\n\t\tif(frm.doc.buyer_type_ == 'Exchange Buyer'){\n\t\t    frm.set_value(\"currently_are_you_using_any_4_wheeler\",\"Yes\");\n\t\t    frm.set_value(\"exchange_require\",\"Yes\");\n\t\t    frm.set_df_property('currently_are_you_using_any_4_wheeler',  'read_only',1);\n\t\t    frm.set_df_property('exchange_require',  'read_only',1);\n\t\t}\n\t\tif(frm.doc.buyer_type_ == 'Additional Car Buyer'){\n\t\t    frm.set_value(\"currently_are_you_using_any_4_wheeler\",\"Yes\");\n\t\t    frm.set_value(\"exchange_require\",\"No\");\n\t\t    frm.set_df_property('currently_are_you_using_any_4_wheeler',  'read_only',1);\n\t\t    frm.set_df_property('exchange_require',  'read_only',1);\n\t\t}\n\t},\n\tbuyer_type_(frm) {\n\t\tif(frm.doc.buyer_type_ == 'First Time'){\n\t\t    frm.set_value(\"currently_are_you_using_any_4_wheeler\",\"No\");\n\t\t    frm.set_value(\"exchange_require\",\"No\");\n\t\t    frm.set_df_property('currently_are_you_using_any_4_wheeler',  'read_only',1);\n\t\t    frm.set_df_property('exchange_require',  'read_only',1);\n\t\t}\n\t\tif(frm.doc.buyer_type_ == 'Exchange Buyer'){\n\t\t    frm.set_value(\"currently_are_you_using_any_4_wheeler\",\"Yes\");\n\t\t    frm.set_value(\"exchange_require\",\"Yes\");\n\t\t    frm.set_df_property('currently_are_you_using_any_4_wheeler',  'read_only',1);\n\t\t    frm.set_df_property('exchange_require',  'read_only',1);\n\t\t}\n\t\tif(frm.doc.buyer_type_ == 'Additional Car Buyer'){\n\t\t    frm.set_value(\"currently_are_you_using_any_4_wheeler\",\"Yes\");\n\t\t    frm.set_value(\"exchange_require\",\"No\");\n\t\t    frm.set_df_property('currently_are_you_using_any_4_wheeler',  'read_only',1);\n\t\t    frm.set_df_property('exchange_require',  'read_only',1);\n\t\t}\n\t}\n});\n\nfrappe.ui.form.on('Lead', {\n\t\"validate\": function(frm,cdt,cdn) {\n\t\tvar dn = frm.doc.follow_up_table;\n\t\tvar date = \"\";\n\t\tvar folloup_by = \"\";\n\t\tfor (var j in dn){\n\t\t\tdate = dn[j].date;\n\t\t\tfolloup_by = dn[j].folloup_by;\n\t\t\t}\n\t\tfrm.set_value(\"contact_date\",date);\n\t\tfrm.set_value(\"contact_by\",folloup_by);\n        }\n});\n\nfrappe.ui.form.on(\"Lead\", {\n  get_notes: function(frm) {\n\tcur_frm.clear_table(\"follow_up_table\");\n\tcur_frm.refresh_fields();\n\t\n    frappe.call({\n    \"method\": \"automobile.automobile.doctype.follow_up_table.follow_up_table.getRemarks\",\nargs: {\nlead: frm.doc.name\n},\ncallback:function(r){\n\tvar len=r.message.length;\n\tconsole.log(r);\n\tfor (var i=0;i<len;i++){\n\t        var row = frm.add_child(\"follow_up_table\");\n\t\trow.document_link = r.message[i][0];\n\t\trow.date = r.message[i][1];\n\t\trow.folloup_by = frappe.session.user;\n\t\trow.note = r.message[i][2];\n\t}\n\t\tcur_frm.refresh_fields();\n\t}\n    });\n}\n});\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Sales Order",
  "modified": "2020-02-28 19:05:55.489583",
  "name": "Sales Order-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "var gt = 0.0;\n\nfrappe.ui.form.on(\"Sales Order\", {    \nrefresh: function(me) {\n    if(me.doc.docstatus != 1){\n        //frm.set_df_property('discount_value',  'read_only', 0);\n\t\t//frm.set_df_property('foc_amount',  'read_only', 0);\n\t\t//frm.set_df_property('tariff_less',  'read_only', 0);\n    \t\tme.page.sidebar.remove(); // this removes the sidebar\n    \t\tme.page.wrapper.find(\".layout-main-section-wrapper\").removeClass(\"col-md-10\"); // this removes class \"col-md-10\" from content block, which sets width to 83%\n    \t}\n}\n});\n\nfrappe.ui.form.on(\"Sales Order\", {\n  get_data: function(frm) {\n\tif(frm.doc.car_template){\n\tcur_frm.clear_table(\"items\");\n\tcur_frm.clear_table(\"taxes\");\n\tvar total = 0;\n\n    frappe.call({\n    \"method\": \"automobile.automobile.doctype.stock.get_data\",\nargs: {\nselling_price_list: frm.doc.selling_price_list,\nitem_code: frm.doc.car_template,\nfrom_date: frm.doc.transaction_date\n},\ncallback:function(r){\n            frm.set_value(\"gt\",0.0);\n            frm.set_value(\"discount_value\",0);\n            frm.set_value(\"discount_settled\",0);\n            frm.set_value(\"foc_amount\",0);\n            frm.set_value(\"tariff_less\",r.message[0][30]);\n            frm.set_value(\"od\",r.message[0][6]);\n            frm.set_value(\"tariff\",r.message[0][30]);\n\t    var row = frm.add_child(\"items\");\n\t\t\trow.item_code = r.message[0][0];\n\t\t\trow.item_name = r.message[0][1];\n\t\t\trow.description = r.message[0][1];\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.is_base_item = 1;\n\t\t\trow.serial_no= frm.doc.serial;\n\t\t\trow.price_list_rate = r.message[0][2];\n       \t\trow.rate = r.message[0][2];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\tif(r.message[0][33] == \"Hyundai\"){\n\t    \n\t    var ttt = ((r.message[0][27] + r.message[0][29]) / 100) + 1;\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Handling Charges\";\n\t\t\trow.item_name = \"Handling Charges\";\n\t\t\trow.description = r.message[0][1];\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][5] / ttt;\n       \t\trow.rate = r.message[0][5] / ttt;\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\n\tif(r.message[0][33] != \"Hyundai\"){\n\t\tvar tt = ((r.message[0][23] + r.message[0][25] + r.message[0][21]) / 100) + 1;\n\t\tconsole.log(tt);\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Handling Charges\";\n\t\t\trow.item_name = \"Handling Charges\";\n\t\t\trow.description = r.message[0][1];\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][5] / tt;\n       \t\trow.rate = r.message[0][5] / tt;\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\n\t\t\n\tif(!frm.doc.self_insurance){\n\t    \n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE Own Damage\";\n\t\t\trow.item_name = \"INSURANCE Own Damage\";\n\t\t\trow.description = \"INSURANCE Own Damage\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][6];\n       \t\trow.rate = r.message[0][6];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE TP & Others\";\n\t\t\trow.item_name = \"INSURANCE TP & Others\";\n\t\t\trow.description = \"INSURANCE TP & Others\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][7];\n       \t\trow.rate = r.message[0][7];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE Zero Dep\";\n\t\t\trow.item_name = \"INSURANCE Zero Dep\";\n\t\t\trow.description = \"INSURANCE Zero Dep\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][8];\n       \t\trow.rate = r.message[0][8];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE GST\";\n\t\t\trow.item_name = \"INSURANCE GST\";\n\t\t\trow.description = \"INSURANCE GST\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][9];\n       \t\trow.rate = r.message[0][9];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\n\t\n\tif(!frm.doc.self_rto_){\n\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"RTO Tax\";\n\t\t\trow.item_name = \"RTO Tax\";\n\t\t\trow.description = \"RTO Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][10];\n       \t\trow.rate = r.message[0][10];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Passing Charges\";\n\t\t\trow.item_name = \"Passing Charges\";\n\t\t\trow.description = \"Passing Charges\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = (r.message[0][11] / 1.18);\n       \t\trow.rate = (r.message[0][11] / 1.18);\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"REGI. CHARGES\";\n\t\t\trow.item_name = \"REGI. CHARGES\";\n\t\t\trow.description = \"REGI. CHARGES\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][12];\n       \t\trow.rate = r.message[0][12];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n    }\t\n    \n        var row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"CRTM Charges\";\n\t\t\trow.item_name = \"CRTM Charges\";\n\t\t\trow.description = \"CRTM Charges\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][31];\n       \t\trow.rate = r.message[0][31];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\tif(!frm.doc.self_mtax){\t\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"M. Tax\";\n\t\t\trow.item_name = \"M. Tax\";\n\t\t\trow.description = \"M. Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][13];\n       \t\trow.rate = r.message[0][13];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\t\n\tif(!frm.doc.no_extended_warranty){\t\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Extended Warranty\";\n\t\t\trow.item_name = \"Extended Warranty\";\n\t\t\trow.description = \"Extended Warranty\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][14];\n       \t\trow.rate = r.message[0][14];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\n\tif(!frm.doc.no_rsa){\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.item_name = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.description = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][15];\n       \t\trow.rate = r.message[0][15];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\n\tif(!frm.doc.no_basic_kit){\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"BASIC KIT\";\n\t\t\trow.item_name = \"BASIC KIT\";\n\t\t\trow.description = \"BASIC KIT\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][16];\n       \t\trow.rate = r.message[0][16];\n       \t\tfrm.set_value(\"std_foc\",r.message[0][16]);\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\n\tif(!frm.doc.no_fastag){\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"FasTAG\";\n\t\t\trow.item_name = \"FasTAG\";\n\t\t\trow.description = \"FasTAG\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][17];\n       \t\trow.rate = r.message[0][17];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\t\n\tif(!frm.doc.self_rto_ && r.message[0][33] != \"Hyundai\"){\n\t    \n\t\tvar tt = ((r.message[0][23] + r.message[0][25] + r.message[0][21]) / 100) + 1;\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][22];\n \t\t\trow.description = r.message[0][22];\n \t\t\trow.rate = r.message[0][23];\n \t\t\trow.tax_amount =  (r.message[0][2] * (r.message[0][23] / 100)) + (r.message[0][5] / tt * (r.message[0][23] / 100));\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][24];\n \t\t\trow.description = r.message[0][24];\n \t\t\trow.rate = r.message[0][25];;\n \t\t\trow.tax_amount =  (r.message[0][2] * (r.message[0][25] / 100)) + (r.message[0][5] / tt * (r.message[0][25] / 100));\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\t\n\t\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][20];\n \t\t\trow.description = r.message[0][20];\n \t\t\trow.rate = r.message[0][21];\n \t\t\trow.tax_amount = (r.message[0][2] * (r.message[0][21] / 100)) + (r.message[0][5] / tt * (r.message[0][21] / 100));\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t}\n\t\n\tif(!frm.doc.self_rto_ && r.message[0][33] == \"Hyundai\"){\t\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][22];\n \t\t\trow.description = r.message[0][22];\n \t\t\trow.rate = r.message[0][23];\n \t\t\trow.tax_amount =  r.message[0][2] * (r.message[0][23] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][24];\n \t\t\trow.description = r.message[0][24];\n \t\t\trow.rate = r.message[0][25];;\n \t\t\trow.tax_amount =  r.message[0][2] * (r.message[0][25] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\t\n\t\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][20];\n \t\t\trow.description = r.message[0][20];\n \t\t\trow.rate = r.message[0][21];\n \t\t\trow.tax_amount = r.message[0][2] * (r.message[0][21] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t}\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = \"BS-07 - TCS Payable - C\";\n \t\t\trow.description = \"TCS\";\n \t\t\trow.rate = 1;\n \t\t\trow.tax_amount = r.message[0][18];\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\tif(!frm.doc.self_rto_ && r.message[0][33] == \"Hyundai\"){\t\n\t\t\n\t\tvar ttt = ((r.message[0][27] + r.message[0][29]) / 100) + 1;\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][26];\n \t\t\trow.description = r.message[0][26];\n \t\t\trow.rate = r.message[0][27];\n \t\t\trow.tax_amount =  ((r.message[0][11] / ttt) * (r.message[0][27] / 100)) + ((r.message[0][5] / ttt) * (r.message[0][27] / 100));\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][28];\n \t\t\trow.description = r.message[0][28];\n \t\t\trow.rate = r.message[0][29];\n \t\t\trow.tax_amount =  ((r.message[0][11] / ttt) * (r.message[0][27] / 100)) + ((r.message[0][5] / ttt) * (r.message[0][27] / 100));\n\t\tcur_frm.refresh_field(\"taxes\");\n\t}\n\t\n\tif(!frm.doc.self_rto_ && r.message[0][33] != \"Hyundai\"){\t\n\t\t\n\t\tvar ttt = ((r.message[0][27] + r.message[0][29]) / 100) + 1;\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][26];\n \t\t\trow.description = r.message[0][26];\n \t\t\trow.rate = r.message[0][27];\n \t\t\trow.tax_amount =  (r.message[0][11] / ttt) * (r.message[0][27] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][28];\n \t\t\trow.description = r.message[0][28];\n \t\t\trow.rate = r.message[0][29];\n \t\t\trow.tax_amount =  (r.message[0][11] / ttt) * (r.message[0][27] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t}\n\t\n\t\tfrm.save();\n}\n    });\n}\n}\n});\n\n\n\nfrappe.ui.form.on('Sales Order',  'after_save',  function(frm) {\n    if(frm.doc.gt == 0){\n        frm.set_value(\"gt\",frm.doc.grand_total);\n    }\n});\n/*-----------------------------------------------------------------------------------------------------------------------------------*/\n\n\nfrappe.ui.form.on(\"Sales Order\", {\n  foc_amount: function(frm) {\n    //frm.set_value(\"gt\",frm.doc.grand_total);\n    var b = ((frm.doc.od / (100 - frm.doc.tariff)) * (frm.doc.tariff_less - frm.doc.tariff)) + frm.doc.foc_amount;\n    var a = (frm.doc.od / (100 - frm.doc.tariff)) * (frm.doc.tariff_less - frm.doc.tariff);\n    var c = b + (a * 0.18);\n    if(!frm.doc.no_basic_kit){\n    if(c < frm.doc.discount_value){\n    if(frm.doc.foc_amount <= frm.doc.std_foc){\n\tcur_frm.clear_table(\"items\");\n\tcur_frm.clear_table(\"taxes\");\n\tvar total = 0;\n\n    frappe.call({\n    \"method\": \"automobile.automobile.doctype.stock.get_data\",\nargs: {\nselling_price_list: frm.doc.selling_price_list,\nitem_code: frm.doc.car_template,\nfrom_date: frm.doc.transaction_date\n},\ncallback:function(r){\n            frm.set_value(\"od\",r.message[0][6]);\n            frm.set_value(\"tariff\",r.message[0][30]);\n            frm.set_value(\"tariff_less\",r.message[0][30]);\n\t    var row = frm.add_child(\"items\");\n\t\t\trow.item_code = r.message[0][0];\n\t\t\trow.item_name = r.message[0][1];\n\t\t\trow.description = r.message[0][1];\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.is_base_item = 1;\n\t\t\trow.serial_no= frm.doc.serial;\n\t\t\trow.price_list_rate = r.message[0][2];\n       \t\trow.rate = r.message[0][2];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Handling Charges\";\n\t\t\trow.item_name = \"Handling Charges\";\n\t\t\trow.description = r.message[0][1];\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][5];\n       \t\trow.rate = r.message[0][5];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\tif(!frm.doc.self_insurance){\n\t    \n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE Own Damage\";\n\t\t\trow.item_name = \"INSURANCE Own Damage\";\n\t\t\trow.description = \"INSURANCE Own Damage\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][6];\n       \t\trow.rate = r.message[0][6];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE TP & Others\";\n\t\t\trow.item_name = \"INSURANCE TP & Others\";\n\t\t\trow.description = \"INSURANCE TP & Others\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][7];\n       \t\trow.rate = r.message[0][7];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE Zero Dep\";\n\t\t\trow.item_name = \"INSURANCE Zero Dep\";\n\t\t\trow.description = \"INSURANCE Zero Dep\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][8];\n       \t\trow.rate = r.message[0][8];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE GST\";\n\t\t\trow.item_name = \"INSURANCE GST\";\n\t\t\trow.description = \"INSURANCE GST\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][9];\n       \t\trow.rate = r.message[0][9];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\n\t\n\tif(!frm.doc.self_rto_){\n\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"RTO Tax\";\n\t\t\trow.item_name = \"RTO Tax\";\n\t\t\trow.description = \"RTO Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][10];\n       \t\trow.rate = r.message[0][10];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Passing Charges\";\n\t\t\trow.item_name = \"Passing Charges\";\n\t\t\trow.description = \"Passing Charges\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = (r.message[0][11] / 1.18);\n       \t\trow.rate = (r.message[0][11] / 1.18);\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"REGI. CHARGES\";\n\t\t\trow.item_name = \"REGI. CHARGES\";\n\t\t\trow.description = \"REGI. CHARGES\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][12];\n       \t\trow.rate = r.message[0][12];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n    }\t\n    \n        var row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"CRTM Charges\";\n\t\t\trow.item_name = \"CRTM Charges\";\n\t\t\trow.description = \"CRTM Charges\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][31];\n       \t\trow.rate = r.message[0][31];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\tif(!frm.doc.self_mtax){\t\t\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"M. Tax\";\n\t\t\trow.item_name = \"M. Tax\";\n\t\t\trow.description = \"M. Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][13];\n       \t\trow.rate = r.message[0][13];\n\t\tcur_frm.refresh_field(\"items\");\n\t\n\t}\n\t\t\n\tif(!frm.doc.no_extended_warranty){\t\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Extended Warranty\";\n\t\t\trow.item_name = \"Extended Warranty\";\n\t\t\trow.description = \"Extended Warranty\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][14];\n       \t\trow.rate = r.message[0][14];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\n\t\n\tif(!frm.doc.no_rsa){\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.item_name = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.description = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][15];\n       \t\trow.rate = r.message[0][15];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\t\n\tif(!frm.doc.no_basic_kit){\n\t        if(frm.doc.foc_amount !== r.message[0][16]){    \n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"BASIC KIT\";\n\t\t\trow.item_name = \"BASIC KIT\";\n\t\t\trow.description = \"BASIC KIT\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.discount_amount = frm.doc.foc_amount;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][16];\n       \t\trow.rate = (r.message[0][16] - frm.doc.foc_amount);\n       \t\tfrm.set_value(\"discount_settled\",frm.doc.foc_amount);\n\t\tcur_frm.refresh_field(\"items\");\n\t\n\t    }        \n\t    }\n\t\n\t    if(!frm.doc.no_basic_kit){\n\t        if(frm.doc.foc_amount == r.message[0][16]){\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"BASIC KIT\";\n\t\t\trow.item_name = \"BASIC KIT\";\n\t\t\trow.description = \"BASIC KIT\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.discount_amount = frm.doc.foc_amount;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][16];\n       \t\trow.rate = 0.0;\n       \t\trow.discount_percentage = 100;\n       \t\tfrm.set_value(\"discount_settled\",c);\n\t\tcur_frm.refresh_field(\"items\");\n\t}\n\t}\n\t\n\tif(!frm.doc.no_fastag){\n\t    \n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"FasTAG\";\n\t\t\trow.item_name = \"FasTAG\";\n\t\t\trow.description = \"FasTAG\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][17];\n       \t\trow.rate = r.message[0][17];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][22];\n \t\t\trow.description = r.message[0][22];\n \t\t\trow.rate = r.message[0][23];\n \t\t\trow.tax_amount =  r.message[0][2] * (r.message[0][23] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][24];\n \t\t\trow.description = r.message[0][24];\n \t\t\trow.rate = r.message[0][25];;\n \t\t\trow.tax_amount =  r.message[0][2] * (r.message[0][25] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\t\n\t\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][20];\n \t\t\trow.description = r.message[0][20];\n \t\t\trow.rate = r.message[0][21];\n \t\t\trow.tax_amount = r.message[0][2] * (r.message[0][21] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = \"BS-07 - TCS Payable - C\";\n \t\t\trow.description = \"TCS\";\n \t\t\trow.rate = 1;\n \t\t\trow.tax_amount = r.message[0][18];\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\tif(!frm.doc.self_rto_){\t\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][26];\n \t\t\trow.description = r.message[0][26];\n \t\t\trow.rate = r.message[0][27];\n \t\t\trow.tax_amount =  (r.message[0][11] / 1.18) * (r.message[0][27] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][28];\n \t\t\trow.description = r.message[0][28];\n \t\t\trow.rate = r.message[0][29];\n \t\t\trow.tax_amount =  (r.message[0][11] / 1.18) * (r.message[0][29] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t}\n}\n    });\n}\n}\n}\n\tif(frm.doc.foc_amount > frm.doc.std_foc){\n        frappe.throw(\"Foc Amount Can Not Be Greater Than Basic Kit Value\")\n    }\n}\n\n});\n\n/*----------------------------------------------------------------------------------------------------------------------------------*/\n\nfrappe.ui.form.on(\"Sales Order\", \"tariff_less\", function(frm) {\n    var b = ((frm.doc.od / (100 - frm.doc.tariff)) * (frm.doc.tariff_less - frm.doc.tariff)) + frm.doc.foc_amount;\n    var a = (frm.doc.od / (100 - frm.doc.tariff)) * (frm.doc.tariff_less - frm.doc.tariff);\n    var c = b + (a * 0.18);\n    if(!frm.doc.self_insurance){\n    if(c < frm.doc.discount_value){\n    cur_frm.clear_table(\"items\");\n\tcur_frm.clear_table(\"taxes\");\n\tvar total = 0;\n\n    frappe.call({\n    \"method\": \"automobile.automobile.doctype.stock.get_data\",\nargs: {\nselling_price_list: frm.doc.selling_price_list,\nitem_code: frm.doc.car_template,\nfrom_date: frm.doc.transaction_date\n},\ncallback:function(r){\n            frm.set_value(\"od\",r.message[0][6]);\n            frm.set_value(\"tariff\",r.message[0][30]);\n\t    var row = frm.add_child(\"items\");\n\t\t\trow.item_code = r.message[0][0];\n\t\t\trow.item_name = r.message[0][1];\n\t\t\trow.description = r.message[0][1];\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.is_base_item = 1;\n\t\t\trow.serial_no= frm.doc.serial;\n\t\t\trow.price_list_rate = r.message[0][2];\n       \t\trow.rate = r.message[0][2];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Handling Charges\";\n\t\t\trow.item_name = \"Handling Charges\";\n\t\t\trow.description = r.message[0][1];\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][5];\n       \t\trow.rate = r.message[0][5];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\tif(!frm.doc.self_insurance){\t\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE Own Damage\";\n\t\t\trow.item_name = \"INSURANCE Own Damage\";\n\t\t\trow.description = \"INSURANCE Own Damage\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][6];\n\t\t\trow.discount_amount = a\n       \t\trow.rate = r.message[0][6] - a;\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE TP & Others\";\n\t\t\trow.item_name = \"INSURANCE TP & Others\";\n\t\t\trow.description = \"INSURANCE TP & Others\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][7];\n       \t\trow.rate = r.message[0][7];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE Zero Dep\";\n\t\t\trow.item_name = \"INSURANCE Zero Dep\";\n\t\t\trow.description = \"INSURANCE Zero Dep\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][8];\n       \t\trow.rate = r.message[0][8];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE GST\";\n\t\t\trow.item_name = \"INSURANCE GST\";\n\t\t\trow.description = \"INSURANCE GST\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.discount_amount = a * 0.18\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][9];\n       \t\trow.rate =  ((r.message[0][6] - a) + r.message[0][7] + r.message[0][8]) * 0.18;\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\tif(!frm.doc.self_rto_){\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"RTO Tax\";\n\t\t\trow.item_name = \"RTO Tax\";\n\t\t\trow.description = \"RTO Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][10];\n       \t\trow.rate = r.message[0][10];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Passing Charges\";\n\t\t\trow.item_name = \"Passing Charges\";\n\t\t\trow.description = \"Passing Charges\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = (r.message[0][11] / 1.18);\n       \t\trow.rate = (r.message[0][11] / 1.18);\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"REGI. CHARGES\";\n\t\t\trow.item_name = \"REGI. CHARGES\";\n\t\t\trow.description = \"REGI. CHARGES\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][12];\n       \t\trow.rate = r.message[0][12];\n\t\tcur_frm.refresh_field(\"items\");\n\t\n\t}\n\t\n\t    var row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"CRTM Charges\";\n\t\t\trow.item_name = \"CRTM Charges\";\n\t\t\trow.description = \"CRTM Charges\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][31];\n       \t\trow.rate = r.message[0][31];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\tif(!frm.doc.self_mtax){\t\t\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"M. Tax\";\n\t\t\trow.item_name = \"M. Tax\";\n\t\t\trow.description = \"M. Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][13];\n       \t\trow.rate = r.message[0][13];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\t\n\tif(!frm.doc.no_extended_warranty){\t\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Extended Warranty\";\n\t\t\trow.item_name = \"Extended Warranty\";\n\t\t\trow.description = \"Extended Warranty\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][14];\n       \t\trow.rate = r.message[0][14];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\n\tif(!frm.doc.no_rsa){\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.item_name = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.description = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][15];\n       \t\trow.rate = r.message[0][15];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\n\tif(!frm.doc.no_basic_kit){\t\n\tif(frm.doc.foc_amount !== r.message[0][16]){\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"BASIC KIT\";\n\t\t\trow.item_name = \"BASIC KIT\";\n\t\t\trow.description = \"BASIC KIT\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.discount_amount = frm.doc.foc_amount;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][16];\n       \t\trow.rate = (r.message[0][16] - frm.doc.foc_amount);\n       \t\tfrm.set_value(\"discount_settled\",c);\n\t\tcur_frm.refresh_field(\"items\");\n\t}\n\t}\n\t\n\tif(!frm.doc.no_basic_kit){\n\tif(frm.doc.foc_amount == r.message[0][16]){\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"BASIC KIT\";\n\t\t\trow.item_name = \"BASIC KIT\";\n\t\t\trow.description = \"BASIC KIT\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.discount_amount = frm.doc.foc_amount;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][16];\n       \t\trow.rate = 0.0;\n       \t\trow.discount_percentage = 100;\n       \t\tfrm.set_value(\"discount_settled\",c);\n\t\tcur_frm.refresh_field(\"items\");\n\t}\n\t}\n\tif(!frm.doc.no_fastag){\t\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"FasTAG\";\n\t\t\trow.item_name = \"FasTAG\";\n\t\t\trow.description = \"FasTAG\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][17];\n       \t\trow.rate = r.message[0][17];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][22];\n \t\t\trow.description = r.message[0][22];\n \t\t\trow.rate = r.message[0][23];\n \t\t\trow.tax_amount =  r.message[0][2] * (r.message[0][23] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][24];\n \t\t\trow.description = r.message[0][24];\n \t\t\trow.rate = r.message[0][25];;\n \t\t\trow.tax_amount =  r.message[0][2] * (r.message[0][25] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\t\n\t\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][20];\n \t\t\trow.description = r.message[0][20];\n \t\t\trow.rate = r.message[0][21];\n \t\t\trow.tax_amount = r.message[0][2] * (r.message[0][21] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = \"BS-07 - TCS Payable - C\";\n \t\t\trow.description = \"TCS\";\n \t\t\trow.rate = 1;\n \t\t\trow.tax_amount = r.message[0][18];\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\tif(!frm.doc.self_rto_){\t\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][26];\n \t\t\trow.description = r.message[0][26];\n \t\t\trow.rate = r.message[0][27];\n \t\t\trow.tax_amount =  (r.message[0][11] / 1.18) * (r.message[0][27] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][28];\n \t\t\trow.description = r.message[0][28];\n \t\t\trow.rate = r.message[0][29];\n \t\t\trow.tax_amount =  (r.message[0][11] / 1.18) * (r.message[0][29] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t}\n}\n\t\n    });\n    }\n    }\n    if(c > frm.doc.discount_value){\n        frappe.throw(\"Discount Value Can Not Be Higher Then Discount Settled\");\n        \n    }\n});\n\n\n\n/************************************************************************************************************************************/\n\n\n\nfrappe.ui.form.on(\"Sales Order\", \"apply_remaining_discount\", function(frm) {\n    if(!frm.doc.no_basic_kit){\n        var b = ((frm.doc.od / (100 - frm.doc.tariff)) * (frm.doc.tariff_less - frm.doc.tariff)) + frm.doc.foc_amount;\n    }\n    if(!frm.doc.self_insurance){\n    var a = (frm.doc.od / (100 - frm.doc.tariff)) * (frm.doc.tariff_less - frm.doc.tariff);\n    }\n    var c = b + (a * 0.18) || 0;\n    var np = 0.0\n    var discount_settled = 0.0;\n    if(frm.doc.discount_value > frm.doc.discount_settled){\n    cur_frm.clear_table(\"items\");\n\tcur_frm.clear_table(\"taxes\");\n\t\n    frappe.call({\n    \"method\": \"automobile.automobile.doctype.stock.get_data\",\nargs: {\nselling_price_list: frm.doc.selling_price_list,\nitem_code: frm.doc.car_template,\nfrom_date: frm.doc.transaction_date\n},\ncallback:function(r){\n        var value_dis = r.message[0][5] + r.message[0][31];\n        if(!frm.doc.self_insurance){\n            value_dis = value_dis + r.message[0][6]+ r.message[0][7]+ r.message[0][8]+ r.message[0][9]; \n        }\n        if(!frm.doc.self_rto_){\n            value_dis = value_dis + r.message[0][11] + r.message[0][12];  \n        }\n        if(!frm.doc.no_extended_warranty){\n            value_dis = value_dis + r.message[0][14];  \n        }\n        if(!frm.doc.no_rsa){\n            value_dis = value_dis + r.message[0][15];  \n        }\n        if(!frm.doc.no_basic_kit){\n            value_dis = value_dis + r.message[0][16];  \n        }\n        if(!frm.doc.no_fastag){\n            value_dis = value_dis + r.message[0][17];  \n        }\n        if(!frm.doc.self_mtax){\n            value_dis = value_dis + r.message[0][32]  \n        }\n        var fix = (r.message[0][5] + r.message[0][6]+ r.message[0][7]+ r.message[0][8]+ r.message[0][9]+ r.message[0][11] + r.message[0][12]+ r.message[0][14]+ r.message[0][15] + r.message[0][16]+ r.message[0][17]) + 25;\n        var dis = frm.doc.discount_value - c;\n        //console.log(\"DIS = \",dis);\n        var x = (dis * r.message[0][2]) / (frm.doc.gt - value_dis);\n        discount_settled = discount_settled + x + c;\n        //console.log(\"x\",x);\n        //console.log(\"dIS vALUE\",value_dis);\n        //console.log(\"FIX\",fix);\n\t    var row = frm.add_child(\"items\");\n\t\t\trow.item_code = r.message[0][0];\n\t\t\trow.item_name = r.message[0][1];\n\t\t\trow.description = r.message[0][1];\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.is_base_item = 1;\n\t\t\trow.price_list_rate = r.message[0][2];\n\t\t\trow.discount_amount = x\n\t\t\trow.serial_no= frm.doc.serial;\n       \t\trow.rate = r.message[0][2] - x;\n       \t\tnp = r.message[0][2] - x;\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Handling Charges\";\n\t\t\trow.item_name = \"Handling Charges\";\n\t\t\trow.description = r.message[0][1];\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][5];\n       \t\trow.rate = r.message[0][5];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\tif(!frm.doc.self_insurance){\t\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE Own Damage\";\n\t\t\trow.item_name = \"INSURANCE Own Damage\";\n\t\t\trow.description = \"INSURANCE Own Damage\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][6];\n\t\t\trow.discount_amount = a\n       \t\trow.rate = r.message[0][6] - a;\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE TP & Others\";\n\t\t\trow.item_name = \"INSURANCE TP & Others\";\n\t\t\trow.description = \"INSURANCE TP & Others\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][7];\n       \t\trow.rate = r.message[0][7];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE Zero Dep\";\n\t\t\trow.item_name = \"INSURANCE Zero Dep\";\n\t\t\trow.description = \"INSURANCE Zero Dep\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][8];\n       \t\trow.rate = r.message[0][8];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE GST\";\n\t\t\trow.item_name = \"INSURANCE GST\";\n\t\t\trow.description = \"INSURANCE GST\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.discount_amount = a * 0.18\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][9];\n       \t\trow.rate =  ((r.message[0][6] - a) + r.message[0][7] + r.message[0][8]) * 0.18;\n\t\tcur_frm.refresh_field(\"items\");\n///////////\t\t\n\t}\n\n    if(!frm.doc.self_rto_){\n\n\tif(frm.doc.selling_price_list == \"Corporate\"){\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"RTO Tax\";\n\t\t\trow.item_name = \"RTO Tax\";\n\t\t\trow.description = \"RTO Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.discount_amount = r.message[0][10] - (np * 0.12);\n\t\t\trow.price_list_rate = r.message[0][10];\n       \t\trow.rate = np * 0.12;\n       \t\tvar rto = r.message[0][10] - (np * 0.12);\n       \t\tdiscount_settled = discount_settled + rto;\n\t\tcur_frm.refresh_field(\"items\");\n\t\t}\n\t\t\n\t\telse{\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"RTO Tax\";\n\t\t\trow.item_name = \"RTO Tax\";\n\t\t\trow.description = \"RTO Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][10];\n       \t\trow.rate = np * 0.06;\n       \t\trow.discount_amount = r.message[0][10] - (np * 0.06);\n       \t\tvar rto = r.message[0][10] - (np * 0.06);\n       \t\tdiscount_settled = discount_settled + rto;\n\t\tcur_frm.refresh_field(\"items\");\n\t\t}\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Passing Charges\";\n\t\t\trow.item_name = \"Passing Charges\";\n\t\t\trow.description = \"Passing Charges\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = (r.message[0][11] / 1.18);\n       \t\trow.rate = (r.message[0][11] / 1.18);\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"REGI. CHARGES\";\n\t\t\trow.item_name = \"REGI. CHARGES\";\n\t\t\trow.description = \"REGI. CHARGES\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][12];\n       \t\trow.rate = r.message[0][12];\n\t\tcur_frm.refresh_field(\"items\");\n    } \n    \n         var row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"CRTM Charges\";\n\t\t\trow.item_name = \"CRTM Charges\";\n\t\t\trow.description = \"CRTM Charges\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][31];\n       \t\trow.rate = r.message[0][31];\n\t\tcur_frm.refresh_field(\"items\");\n    \n    if(!frm.doc.self_mtax){\t\n    \n        if(np > 299999 && np < 499999){\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"M. Tax\";\n\t\t\trow.item_name = \"M. Tax\";\n\t\t\trow.description = \"M. Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.discount_amount = r.message[0][13] - ((np * 0.0175) + 25);\n\t\t\trow.price_list_rate = r.message[0][13];\n       \t\trow.rate = (np * 0.0175) + 25;\n       \t\tvar mt = r.message[0][13] - ((np * 0.0175) + 25);\n       \t\tdiscount_settled = discount_settled + mt;\n\t\tcur_frm.refresh_field(\"items\");\n        }\n        if(np > 499999 && np < 999999){\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"M. Tax\";\n\t\t\trow.item_name = \"M. Tax\";\n\t\t\trow.description = \"M. Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][13];\n       \t\trow.rate = (np * 0.02) + 25;\n       \t\trow.discount_amount = r.message[0][13] - ((np * 0.02) + 25);\n       \t\tvar mt = r.message[0][13] - ((np * 0.02) + 25);\n       \t\tdiscount_settled = discount_settled + mt;\n\t\tcur_frm.refresh_field(\"items\");\n        }\n        if(np > 999999 && np < 1999999){\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"M. Tax\";\n\t\t\trow.item_name = \"M. Tax\";\n\t\t\trow.description = \"M. Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][13];\n       \t\trow.rate = (np * 0.0225) + 25;\n       \t\trow.discount_amount = r.message[0][13] - ((np * 0.0225) + 25);\n       \t\tvar mt = r.message[0][13] - ((np * 0.0225) + 25);\n       \t\tdiscount_settled = discount_settled + mt;\n\t\tcur_frm.refresh_field(\"items\");\n        }\n        if(np > 1999999){\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"M. Tax\";\n\t\t\trow.item_name = \"M. Tax\";\n\t\t\trow.description = \"M. Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][13];\n       \t\trow.rate = (np * 0.025) + 25;\n       \t\trow.discount_amount = r.message[0][13] - ((np * 0.025) + 25);\n       \t\tvar mt = r.message[0][13] - ((np * 0.025) + 25);\n       \t\tdiscount_settled = discount_settled + mt;\n\t\tcur_frm.refresh_field(\"items\");\n        }\n        \n        if(np < 299999){\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"M. Tax\";\n\t\t\trow.item_name = \"M. Tax\";\n\t\t\trow.description = \"M. Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][13];\n       \t\trow.rate = (np * 0.001) + 25;\n       \t\trow.discount_amount = r.message[0][13] - ((np * 0.001) + 25);\n       \t\tvar mt = r.message[0][13] - ((np * 0.001) + 25);\n       \t\tdiscount_settled = discount_settled + mt;\n\t\tcur_frm.refresh_field(\"items\");\n        }\n    }\n    \n    if(!frm.doc.no_extended_warranty){\n        \n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Extended Warranty\";\n\t\t\trow.item_name = \"Extended Warranty\";\n\t\t\trow.description = \"Extended Warranty\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][14];\n       \t\trow.rate = r.message[0][14];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n    }\t\n    \n    if(!frm.doc.no_rsa){\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.item_name = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.description = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][15];\n       \t\trow.rate = r.message[0][15];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n    }\t\n\t\t\n\tif(!frm.doc.no_basic_kit){\t\n\tif(frm.doc.foc_amount !== r.message[0][16]){\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"BASIC KIT\";\n\t\t\trow.item_name = \"BASIC KIT\";\n\t\t\trow.description = \"BASIC KIT\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.discount_amount = frm.doc.foc_amount;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][16];\n       \t\trow.rate = (r.message[0][16] - frm.doc.foc_amount);\n\t\tcur_frm.refresh_field(\"items\");\n\t}\n\t\n\tif(frm.doc.foc_amount == r.message[0][16]){\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"BASIC KIT\";\n\t\t\trow.item_name = \"BASIC KIT\";\n\t\t\trow.description = \"BASIC KIT\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.discount_amount = frm.doc.foc_amount;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][16];\n       \t\trow.rate = 0.0;\n       \t\trow.discount_percentage = 100;\n\t\tcur_frm.refresh_field(\"items\");\n\t}\n\t}\n\tif(!frm.doc.no_fastag){\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"FasTAG\";\n\t\t\trow.item_name = \"FasTAG\";\n\t\t\trow.description = \"FasTAG\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][17];\n       \t\trow.rate = r.message[0][17];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][22];\n \t\t\trow.description = r.message[0][22];\n \t\t\trow.rate = r.message[0][23];\n \t\t\trow.tax_amount =  (r.message[0][2] - x) * (r.message[0][23] / 100);\n \t\t\tvar t = ((r.message[0][2]) * (r.message[0][23] / 100)) - ((r.message[0][2] - x) * (r.message[0][23] / 100));\n \t\t\tdiscount_settled = discount_settled + t + t;\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][24];\n \t\t\trow.description = r.message[0][24];\n \t\t\trow.rate = r.message[0][25];;\n \t\t\trow.tax_amount =  (r.message[0][2] - x) * (r.message[0][25] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\t\n\t\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][20];\n \t\t\trow.description = r.message[0][20];\n \t\t\trow.rate = r.message[0][21];\n \t\t\trow.tax_amount = (r.message[0][2] - x) * (r.message[0][21] / 100);\n \t\t\tvar t2 = ((r.message[0][2]) * (r.message[0][21] / 100)) - ((r.message[0][2] - x) * (r.message[0][21] / 100));\n \t\t\tdiscount_settled = discount_settled + t2;\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = \"BS-07 - TCS Payable - C\";\n \t\t\trow.description = \"TCS\";\n \t\t\trow.rate = 1;\n \t\t\trow.tax_amount = r.message[0][18];\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\tif(!frm.doc.self_rto_){\t\t\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][26];\n \t\t\trow.description = r.message[0][26];\n \t\t\trow.rate = r.message[0][27];\n \t\t\trow.tax_amount =  (r.message[0][11] / 1.18) * (r.message[0][27] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][28];\n \t\t\trow.description = r.message[0][28];\n \t\t\trow.rate = r.message[0][29];\n \t\t\trow.tax_amount =  (r.message[0][11] / 1.18) * (r.message[0][29] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t}\t\n\t\t\n\t\tfrm.set_value(\"discount_settled\",discount_settled);\n\t\t//console.log(discount_settled);\n\t\t//console.log((x + c + t + t + t2 + mt + rto));\n\t\t//frm.set_df_property('discount_value',  'read_only', 1);\n\t\t//frm.set_df_property('foc_amount',  'read_only', 1);\n\t\t//frm.set_df_property('tariff_less',  'read_only', 1);\n\t}\n    });\n    }\n        if(frm.doc.discount_value <= frm.doc.discount_settled){\n\t        frappe.throw(\"Discount Already Settled\");\n\t    }\n});\n\nfrappe.ui.form.on(\"Sales Order\", {\n  discount_value: function(frm) {\n\tif(frm.doc.car_template){\n\tcur_frm.clear_table(\"items\");\n\tcur_frm.clear_table(\"taxes\");\n\tvar total = 0;\n\n    frappe.call({\n    \"method\": \"automobile.automobile.doctype.stock.get_data\",\nargs: {\nselling_price_list: frm.doc.selling_price_list,\nitem_code: frm.doc.car_template,\nfrom_date: frm.doc.transaction_date\n},\ncallback:function(r){\n            frm.set_value(\"discount_settled\",0);\n            frm.set_value(\"foc_amount\",0);\n            frm.set_value(\"tariff_less\",r.message[0][30]);\n            frm.set_value(\"od\",r.message[0][6]);\n            frm.set_value(\"tariff\",r.message[0][30]);\n\t    var row = frm.add_child(\"items\");\n\t\t\trow.item_code = r.message[0][0];\n\t\t\trow.item_name = r.message[0][1];\n\t\t\trow.description = r.message[0][1];\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.is_base_item = 1;\n\t\t\trow.serial_no= frm.doc.serial;\n\t\t\trow.price_list_rate = r.message[0][2];\n       \t\trow.rate = r.message[0][2];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Handling Charges\";\n\t\t\trow.item_name = \"Handling Charges\";\n\t\t\trow.description = r.message[0][1];\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][5];\n       \t\trow.rate = r.message[0][5];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\tif(!frm.doc.self_insurance){\n\t    \n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE Own Damage\";\n\t\t\trow.item_name = \"INSURANCE Own Damage\";\n\t\t\trow.description = \"INSURANCE Own Damage\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][6];\n       \t\trow.rate = r.message[0][6];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE TP & Others\";\n\t\t\trow.item_name = \"INSURANCE TP & Others\";\n\t\t\trow.description = \"INSURANCE TP & Others\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][7];\n       \t\trow.rate = r.message[0][7];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE Zero Dep\";\n\t\t\trow.item_name = \"INSURANCE Zero Dep\";\n\t\t\trow.description = \"INSURANCE Zero Dep\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][8];\n       \t\trow.rate = r.message[0][8];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"INSURANCE GST\";\n\t\t\trow.item_name = \"INSURANCE GST\";\n\t\t\trow.description = \"INSURANCE GST\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_insurance = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][9];\n       \t\trow.rate = r.message[0][9];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\n\t\n\tif(!frm.doc.self_rto_){\n\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"RTO Tax\";\n\t\t\trow.item_name = \"RTO Tax\";\n\t\t\trow.description = \"RTO Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][10];\n       \t\trow.rate = r.message[0][10];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Passing Charges\";\n\t\t\trow.item_name = \"Passing Charges\";\n\t\t\trow.description = \"Passing Charges\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = (r.message[0][11] / 1.18);\n       \t\trow.rate = (r.message[0][11] / 1.18);\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"REGI. CHARGES\";\n\t\t\trow.item_name = \"REGI. CHARGES\";\n\t\t\trow.description = \"REGI. CHARGES\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][12];\n       \t\trow.rate = r.message[0][12];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n    }\t\n    \n        var row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"CRTM Charges\";\n\t\t\trow.item_name = \"CRTM Charges\";\n\t\t\trow.description = \"CRTM Charges\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.is_rto = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][31];\n       \t\trow.rate = r.message[0][31];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\tif(!frm.doc.self_mtax){\t\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"M. Tax\";\n\t\t\trow.item_name = \"M. Tax\";\n\t\t\trow.description = \"M. Tax\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][13];\n       \t\trow.rate = r.message[0][13];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\t\n\tif(!frm.doc.no_extended_warranty){\t\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"Extended Warranty\";\n\t\t\trow.item_name = \"Extended Warranty\";\n\t\t\trow.description = \"Extended Warranty\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][14];\n       \t\trow.rate = r.message[0][14];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\n\tif(!frm.doc.no_rsa){\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.item_name = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.description = \"RSA CHARGES (1 YEAR)\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][15];\n       \t\trow.rate = r.message[0][15];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\n\tif(!frm.doc.no_basic_kit){\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"BASIC KIT\";\n\t\t\trow.item_name = \"BASIC KIT\";\n\t\t\trow.description = \"BASIC KIT\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][16];\n       \t\trow.rate = r.message[0][16];\n       \t\tfrm.set_value(\"std_foc\",r.message[0][16]);\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\n\tif(!frm.doc.no_fastag){\n\t\t\n\t\tvar row = frm.add_child(\"items\");\n\t\t\trow.item_code = \"FasTAG\";\n\t\t\trow.item_name = \"FasTAG\";\n\t\t\trow.description = \"FasTAG\";\n\t\t\trow.delivery_date = frm.doc.delivery_date;\n\t\t\trow.qty = 1;\n\t\t\trow.uom = \"Nos\";\n\t\t\trow.price_list_rate = r.message[0][17];\n       \t\trow.rate = r.message[0][17];\n\t\tcur_frm.refresh_field(\"items\");\n\t\t\n\t}\t\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][22];\n \t\t\trow.description = r.message[0][22];\n \t\t\trow.rate = r.message[0][23];\n \t\t\trow.tax_amount =  r.message[0][2] * (r.message[0][23] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][24];\n \t\t\trow.description = r.message[0][24];\n \t\t\trow.rate = r.message[0][25];;\n \t\t\trow.tax_amount =  r.message[0][2] * (r.message[0][25] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\t\n\t\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][20];\n \t\t\trow.description = r.message[0][20];\n \t\t\trow.rate = r.message[0][21];\n \t\t\trow.tax_amount = r.message[0][2] * (r.message[0][21] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = \"BS-07 - TCS Payable - C\";\n \t\t\trow.description = \"TCS\";\n \t\t\trow.rate = 1;\n \t\t\trow.tax_amount = r.message[0][18];\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\tif(!frm.doc.self_rto_){\t\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][26];\n \t\t\trow.description = r.message[0][26];\n \t\t\trow.rate = r.message[0][27];\n \t\t\trow.tax_amount =  (r.message[0][11] / 1.18) * (r.message[0][27] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t\t\n\t\tvar row = frm.add_child(\"taxes\");\n\t\t\trow.charge_type = \"Actual\";\n \t\t\trow.account_head = r.message[0][28];\n \t\t\trow.description = r.message[0][28];\n \t\t\trow.rate = r.message[0][29];\n \t\t\trow.tax_amount =  (r.message[0][11] / 1.18) * (r.message[0][29] / 100);\n\t\tcur_frm.refresh_field(\"taxes\");\n\t}\n}\n    });\n}\n}\n});\n\nfrappe.ui.form.on(\"Sales Order\", {\n  car_template: function(frm) {\n\t\n    frappe.call({\n    \"method\": \"automobile.automobile.doctype.stock.SerailNO\",\nargs: {\ncompany: frm.doc.company,    \nitem_code: frm.doc.car_template\n},\ncallback:function(r){\n\tconsole.log(r.message[0][0]);\n\tfrm.set_value(\"set_warehouse\",r.message[0][1]);\n\tfrm.set_value(\"serial\",r.message[0][0]);\n\t}\n    });\n}\n});\n\nfrappe.ui.form.on(\"Sales Order\", {\n  onload: function(frm) {\n\tif(frm.doc.__islocal){\n    frappe.call({\n    \"method\": \"automobile.automobile.doctype.stock.getAlloted\",\nargs: {\ncompany: frm.doc.company\n},\ncallback:function(r){\n\tfrm.set_value(\"set_source_warehouse\",r.message[0][0]);\n\t}\n    });\n}\n}\n});\n\nfrappe.ui.form.on(\"Sales Order\", {\n  company: function(frm) {\n    frappe.call({\n    \"method\": \"automobile.automobile.doctype.stock.getAlloted\",\nargs: {\ncompany: frm.doc.company\n},\ncallback:function(r){\n\tfrm.set_value(\"set_source_warehouse\",r.message[0][0]);\n\t}\n    });\n}\n});"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Item",
  "modified": "2019-12-23 17:51:34.031739",
  "name": "Item-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Item',  {\n    refresh: function(frm) {\n        // use the __islocal value of doc,  to check if the doc is saved or not\n        frm.set_df_property('has_serial_no',  'read_only',  0);\n    } \n});"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Item Price",
  "modified": "2019-12-25 15:42:00.398163",
  "name": "Item Price-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on(\"Item Price\", \"onload\", function(frm) {\n    cur_frm.set_query(\"gst_cess_accoun\", function() {\n        return {\n            \"filters\": {\n                \"account_type\": \"Tax\",\n                \"is_group\": 0\n                }\n        };\n    });\n});\n\nfrappe.ui.form.on(\"Item Price\", \"onload\", function(frm) {\n    cur_frm.set_query(\"sgst_14_account\", function() {\n        return {\n            \"filters\": {\n                \"account_type\": \"Tax\",\n                \"is_group\": 0\n                }\n        };\n    });\n});\n\nfrappe.ui.form.on(\"Item Price\", \"onload\", function(frm) {\n    cur_frm.set_query(\"cgst_14_account\", function() {\n        return {\n            \"filters\": {\n                \"account_type\": \"Tax\",\n                \"is_group\": 0\n                }\n        };\n    });\n});\n\nfrappe.ui.form.on(\"Item Price\", \"onload\", function(frm) {\n    cur_frm.set_query(\"sgst_9_account\", function() {\n        return {\n            \"filters\": {\n                \"account_type\": \"Tax\",\n                \"is_group\": 0\n                }\n        };\n    });\n});\n\nfrappe.ui.form.on(\"Item Price\", \"onload\", function(frm) {\n    cur_frm.set_query(\"cgst_9_account\", function() {\n        return {\n            \"filters\": {\n                \"account_type\": \"Tax\",\n                \"is_group\": 0\n                }\n        };\n    });\n});\n\ncur_frm.add_fetch('gst_cess_accoun',  'tax_rate',  'gst_cess');\ncur_frm.add_fetch('sgst_14_account',  'tax_rate',  'sgst_14');\ncur_frm.add_fetch('cgst_14_account',  'tax_rate',  'cgst_14');\ncur_frm.add_fetch('sgst_9_account',  'tax_rate',  'sgst_9');\ncur_frm.add_fetch('cgst_9_account',  'tax_rate',  'cgst_9');\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Delivery Note",
  "modified": "2020-02-27 18:53:25.467798",
  "name": "Delivery Note-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Delivery Note', {\n\tvalidate(frm) {\n\t\tfrm.set_value(\"set_warehouse\",frm.doc.set_source_warehouse);\n\t\t$.each(frm.doc.items || [], function(i, d) {\n\tif(d.is_base_item == 1){\t    \n\t\t d.serial_no = frm.doc.serial;\n\t} \n\t\t});\n\t\trefresh_field(\"items\");\n\t}\n});"
 }
]